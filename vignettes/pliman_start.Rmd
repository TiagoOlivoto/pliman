---
title: "Plant IMage Analysis"
author: "Tiago Olivoto"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
fig_caption: yes
link-citations: true
vignette: >
  %\VignetteIndexEntry{Plant IMage Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(comment = "#", collapse = TRUE, fig.width = 5)
```

# Getting started

The pliman (**pl**ant **im**age **an**alysis) package is designed to analyze plant images, particularly for leaf and seed analysis. It offers a range of functionalities to assist with various tasks such as measuring disease severity, counting lesions, obtaining lesion shapes, counting objects in an image, extracting object characteristics, performing Fourier Analysis, obtaining RGB values, extracting object coordinates and outlines, isolating objects, and plotting object measurements.

# Leaf area measurement

To measure the leaf area in an image, you can use the analyze_objects() function. There are two ways to adjust the pixel area to metric units (cm):

-   Using an object of known area to correct the measurements
-   Knowing the image resolution in dots per inch (dpi)

## Adjusting leaf area using a known object

To demonstrate the first approach, let's count the number of objects and plot their IDs using the marker = "id" argument in the `analyze_objects()` function. This allows us to adjust the leaf area using a known object, in this case, a leaf square with an area of 4 cmÂ².

```{r}
library(pliman)
leaves <- image_pliman("la_leaves.jpg")
plot(leaves)
count <- analyze_objects(leaves, marker = "id")
```

To adjust the leaf area using the known object (id = 6), we can utilize the `get_measures()` function.


```{r leaf6}
area <- 
  get_measures(count,
               id = 6,
               area ~ 4)
str(area)
# plot the area to the segmented image
image_segment(leaves, index = "NB", verbose = FALSE)
plot(leaves)
plot_measures(area, measure = "area")

```

## Adjusting leaf area using image resolution

When the image resolution is known, we can use the `dpi()` function to compute the dots per inch (dpi) of an image. This allows us to convert pixel units to metric units. To apply this method, you need to know the size of any object in the image. You can refer to a tutorial [here](https://www.youtube.com/watch?v=Rh10_pLgeng) for more details.

```{r}
area_dpi <- get_measures(count, dpi = 83.5)
plot(leaves)
plot_measures(area_dpi,
              measure = "area",
              vjust = -25)
```

# Counting crop grains

Here, we will count the grains in the image `soybean_touch.jpg`. This image has a cyan background and contains 30 soybean grains that touch each other.

```{r}
soy <- image_pliman("soybean_touch.jpg")
plot(soy)

# Count the objects in the image
grains <- analyze_objects(soy)

# Draws the object id (by default)
plot_measures(grains)
```

# Disease severity

## Using image indexes

To compute the percentage of symptomatic leaf area you can use the `measure_disease()` function you can use an image index to segment the entire leaf from the background and then separate the diseased tissue from the healthy tissue. Alternatively, you can provide color palette samples to the `measure_disease()` function. In this approach, the function fits a general linear model (binomial family) to the RGB values of the image. It then uses the color palette samples to segment the lesions from the healthy leaf.

In the following example, we compute the symptomatic area of a soybean leaf. The proportion of healthy and symptomatic areas is given as a proportion of the total leaf area after segmenting the leaf from the background (blue).

```{r}
img <- image_pliman("sev_leaf.jpg")
# Computes the symptomatic area
measure_disease(img = img,
                index_lb = "B", # to remove the background
                index_dh = "NGRDI", # to isolate the diseased area
                threshold = c("Otsu", 0), # You can also use the Otsu algorithm in both indexes (default)
                plot = TRUE)
```


## Interactive disease measurements

An alternative approach to measuring disease percentage is available through the `measure_disease_iter()` function. This function offers an interactive interface that empowers users to manually select sample colors directly from the image. By doing so, it provides a highly customizable analysis method.

One advantage of using `measure_disease_iter()` is the ability to utilize the "mapview" viewer, which enhances the analysis process by offering zoom-in options. This feature allows users to closely examine specific areas of the image, enabling detailed inspection and accurate disease measurement.


```{r eval=FALSE}
img <- image_pliman("sev_leaf.jpg", plot = TRUE)
measure_disease_iter(img, viewer = "mapview")
```

# RGB values for objects

The function `analyze_objects()` can also be used to get the Red Green and Blue (RGB) -or any other image index- for objects in an image. To do that, use the argument `object_index`.

```{r}
img <- image_pliman("soy_green.jpg")
# Segment the foreground (grains) using the normalized blue index
# Shows the average value of the blue index in each object

rgb <- 
  analyze_objects(img,
                  object_index = "B",
                  pixel_level_index = TRUE)
# Plots the B index for each grain
plot_measures(rgb, measure = "B")
```

# Getting help

If you come across any clear bugs while using the package, please consider filing a minimal reproducible example on [github](https://github.com/TiagoOlivoto/pliman/issues). This will help the developers address the issue promptly.

Suggestions and criticisms aimed at improving the quality and usability of the package are highly encouraged. Your feedback is valuable in making {pliman} even better!

# <i class="fas fa-scroll"></i> A little bit more!

For more examples on how to utilize {pliman} for analyzing plant images, you can visit this [this link](https://tiagoolivoto.github.io/paper_pliman/code.html). On that page, you will find downloadable source code and images that can be used for your analysis. Additionally, you can watch a talk about {pliman} (in Portuguese) [here](https://www.youtube.com/watch?v=ElvUVlPocgA) to gain more insights and tips on using the package effectively.

<i class="far fa-lightbulb"></i> Get ready with your project and let {pliman} shine with its <i class="fas fa-camera"></i> image analysis capabilities!
