<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count objects in an image â€¢ pliman</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Count objects in an image">
<meta property="og:description" content="pliman">
<meta property="og:image" content="https://tiagoolivoto.github.io/pliman/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-VWN5YL53DP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VWN5YL53DP');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pliman</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/operations.html">Image Operations</a>
    </li>
    <li>
      <a href="../articles/manipulation.html">Image manipulation</a>
    </li>
    <li>
      <a href="../articles/segmentation.html">Image segmentation</a>
    </li>
    <li>
      <a href="../articles/count_objects.html">Count objects in an image</a>
    </li>
    <li>
      <a href="../articles/leaf_area.html">Measure leaf area</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../CODE_OF_CONDUCT.html">Code of Conduct</a>
    </li>
    <li>
      <a href="../CONTRIBUTING.html">Contributing</a>
    </li>
    <li>
      <a href="../ISSUE_TEMPLATE.html">Issues</a>
    </li>
    <li>
      <a href="../SUPPORT.html">Support</a>
    </li>
    <li>
      <a href="../LICENSE.html">Licence</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.researchgate.net/profile/Tiago_Olivoto2">RG</a>
</li>
<li>
  <a href="https://github.com/TiagoOlivoto">
    <span class="fab fab-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/tolivoto">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://www.mendeley.com/profiles/tiago-olivoto/">
    <span class="fab fa-mendeley"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="count_objects_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Count objects in an image</h1>
                        <h4 class="author">Tiago Olivoto</h4>
            
            <h4 class="date">2021-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/TiagoOlivoto/pliman/blob/master/vignettes/count_objects.Rmd"><code>vignettes/count_objects.Rmd</code></a></small>
      <div class="hidden name"><code>count_objects.Rmd</code></div>

    </div>

    
    
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<p>The function <code><a href="../reference/count_objects.html">count_objects()</a></code> can be used to count objects in an image. Let us start with a simple example with the image <code>object_300dpi.png</code> available in the <a href="https://github.com/TiagoOlivoto/pliman/tree/master/image_examples">GitHub page</a>. To facilitate the image importation from this folder, a helper function <code><a href="../reference/utils_image.html">image_pliman()</a></code> is used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TiagoOlivoto/pliman">pliman</a></span><span class="op">)</span>
<span class="co">#&gt; |========================================================|</span>
<span class="co">#&gt; | Tools for Plant Image Analysis (pliman 0.3.0)          |</span>
<span class="co">#&gt; | Author: Tiago Olivoto                                  |</span>
<span class="co">#&gt; | Type 'vignette('pliman_start')' for a short tutorial   |</span>
<span class="co">#&gt; | Visit 'https://bit.ly/3eL0dF3' for a complete tutorial |</span>
<span class="co">#&gt; |========================================================|</span>
<span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"objects_300dpi.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/utils_image.html">image_show</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-2-1.png" width="960"></p>
<p>The above image was produced with Microsoft PowerPoint. It has a known resolution of 300 dpi (dots per inch) and shows four objects</p>
<ul>
<li>Larger square: 10 x 10 cm (100 cm<sup>2</sup>)</li>
<li>Smaller square: 5 x 5 cm (25 cm<sup>2</sup>)</li>
<li>Rectangle: 4 x 2 cm (8 cm<sup>2</sup>)</li>
<li>Circle: 3 cm in diameter (~7.08 cm<sup>2</sup>)</li>
</ul>
<p>To count the objects in the image we use <code><a href="../reference/count_objects.html">count_objects()</a></code> and inform the image object (the only mandatory argument). First, we use <code><a href="../reference/image_binary.html">image_binary()</a></code> to see the most suitable index to segment the objects from the background. By default, the R, G, B (first row) and their normalized values (second row) are used.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/image_binary.html">image_binary</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img_res</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">img</span>,
                index <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="co"># use blue index to segment</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 4 
#&gt; --------------------------------------------
#&gt;  statistics      area perimeter
#&gt;         min   98363.0  1030.000
#&gt;        mean  488297.5  2378.000
#&gt;         max 1394754.0  4715.000
#&gt;          sd  615160.4  1655.097
#&gt;         sum 1953190.0  9512.000</code></pre>
</div>
<div id="getting-the-object-measures" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-the-object-measures" class="anchor"></a>Getting the object measures</h1>
<p>The results were stored in <code>img_res</code> and a summary print in the console. The minimum, mean, maximum, standard deviation and sum of pixels are given for both area and perimeter. The values for each object can be obtained with <code><a href="../reference/utils_measures.html">get_measures()</a></code>. Since there is no scale declared in the above example, we have no idea about the actual area of the objects in cm<sup>2</sup>, only in pixels.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   id        x        y    area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  669.000  798.000 1394754      4715     677.031    589.875    833.680</span>
<span class="co">#&gt; 2  2 1737.500  453.000  348690      2358     338.312    294.500    416.840</span>
<span class="co">#&gt; 3  3 1737.548 1296.345   98363      1030     176.490    174.878    177.891</span>
<span class="co">#&gt; 4  4 1737.498  939.493  111383      1409     197.447    117.413    262.997</span>
<span class="co">#&gt;   radius_sd radius_ratio</span>
<span class="co">#&gt; 1    74.267        1.413</span>
<span class="co">#&gt; 2    37.171        1.415</span>
<span class="co">#&gt; 3     0.501        1.017</span>
<span class="co">#&gt; 4    49.911        2.240</span>
<span class="fu"><a href="../reference/utils_image.html">image_show</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
<span class="fu"><a href="../reference/utils_measures.html">plot_measures</a></span><span class="op">(</span><span class="va">measures</span><span class="op">)</span> <span class="co"># plot the object id</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ls_px</span> <span class="op">&lt;-</span> <span class="va">measures</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span> <span class="co"># number of pixels (perimeter) of the largest square</span></code></pre></div>
</div>
<div id="adjusting-object-measures" class="section level1">
<h1 class="hasAnchor">
<a href="#adjusting-object-measures" class="anchor"></a>Adjusting object measures</h1>
<p>There are two main ways of adjusting the object measures (from pixels to cm, for example). The first one is to declare the known area, perimeter, or radius of a given object. The measure for the other objects will be then computed by a simple rule of three. The second one is by declaring a known image resolution in dpi (dots per inch). In this case, the perimeter, area, and radius will be adjusted by the informed dpi.</p>
<div id="declaring-a-known-value" class="section level2">
<h2 class="hasAnchor">
<a href="#declaring-a-known-value" class="anchor"></a>Declaring a known value</h2>
<p>Since we have known the area of the larger square (object 1), let us adjust the area of the other objects in the image using that.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>,
             id <span class="op">=</span> <span class="fl">1</span>,
             <span class="va">area</span> <span class="op">~</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; measures corrected with:</span>
<span class="co">#&gt; object id: 1</span>
<span class="co">#&gt; area     : 100</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; Total    : 140.038 </span>
<span class="co">#&gt; Average  : 35.01 </span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt;   id        x        y    area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  669.000  798.000 100.000    39.924       5.733      4.995      7.059</span>
<span class="co">#&gt; 2  2 1737.500  453.000  25.000    19.966       2.865      2.494      3.530</span>
<span class="co">#&gt; 3  3 1737.548 1296.345   7.052     8.721       1.494      1.481      1.506</span>
<span class="co">#&gt; 4  4 1737.498  939.493   7.986    11.931       1.672      0.994      2.227</span>
<span class="co">#&gt;   radius_sd radius_ratio</span>
<span class="co">#&gt; 1    74.267        1.413</span>
<span class="co">#&gt; 2    37.171        1.415</span>
<span class="co">#&gt; 3     0.501        1.017</span>
<span class="co">#&gt; 4    49.911        2.240</span></code></pre></div>
<p>The same can be used to adjust the measures based on the perimeter or radius. Let us adjust the perimeter of objects by the perimeter of object 2 (20 cm).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>,
             id <span class="op">=</span> <span class="fl">2</span>,
             <span class="va">perimeter</span> <span class="op">~</span> <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; measures corrected with:</span>
<span class="co">#&gt; object id: 2</span>
<span class="co">#&gt; perimeter     : 20</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; Total    : 80.679 </span>
<span class="co">#&gt; Average  : 20.17 </span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt;   id        x        y    area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  669.000  798.000 100.339    39.992       5.742      5.003      7.071</span>
<span class="co">#&gt; 2  2 1737.500  453.000  25.085    20.000       2.869      2.498      3.536</span>
<span class="co">#&gt; 3  3 1737.548 1296.345   7.076     8.736       1.497      1.483      1.509</span>
<span class="co">#&gt; 4  4 1737.498  939.493   8.013    11.951       1.675      0.996      2.231</span>
<span class="co">#&gt;   radius_sd radius_ratio</span>
<span class="co">#&gt; 1    74.267        1.413</span>
<span class="co">#&gt; 2    37.171        1.415</span>
<span class="co">#&gt; 3     0.501        1.017</span>
<span class="co">#&gt; 4    49.911        2.240</span></code></pre></div>
</div>
<div id="declaring-the-image-resolution" class="section level2">
<h2 class="hasAnchor">
<a href="#declaring-the-image-resolution" class="anchor"></a>Declaring the image resolution</h2>
<p>If the image resolution is known, all the measures will be adjusted according to this resolution. Let us to see a numerical example with <code><a href="../reference/utils_dpi.html">pixels_to_cm()</a></code>. This function converts the number of pixels (<span class="math inline">\(px\)</span>) to cm, considering the image resolution in <span class="math inline">\(dpi\)</span>, as follows: <span class="math inline">\(cm = px \times (2.54/dpi)\)</span>. Since we known the number of pixels of the larger square, its perimeter in cm is given by</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ls_px</span>
<span class="co">#&gt; [1] 4715</span>
<span class="fu"><a href="../reference/utils_dpi.html">pixels_to_cm</a></span><span class="op">(</span>px <span class="op">=</span> <span class="va">ls_px</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#&gt; [1] 39.92033</span></code></pre></div>
<p>The perimeter of object 1 adjusted by the image resolution is very close to the true (40 cm). Bellow, the values of all measures are adjusted by declaring the <code>dpi</code> argument in <code><a href="../reference/utils_measures.html">get_measures()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#&gt;   id        x        y   area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  669.000  798.000 99.982    39.920       5.732      4.994      7.058</span>
<span class="co">#&gt; 2  2 1737.500  453.000 24.996    19.964       2.864      2.493      3.529</span>
<span class="co">#&gt; 3  3 1737.548 1296.345  7.051     8.721       1.494      1.481      1.506</span>
<span class="co">#&gt; 4  4 1737.498  939.493  7.984    11.930       1.672      0.994      2.227</span>
<span class="co">#&gt;   radius_sd radius_ratio</span>
<span class="co">#&gt; 1    74.267        1.413</span>
<span class="co">#&gt; 2    37.171        1.415</span>
<span class="co">#&gt; 3     0.501        1.017</span>
<span class="co">#&gt; 4    49.911        2.240</span></code></pre></div>
</div>
</div>
<div id="counting-crop-grains" class="section level1">
<h1 class="hasAnchor">
<a href="#counting-crop-grains" class="anchor"></a>Counting crop grains</h1>
<p>Here, we will count the grains in the image <code>soybean_touch.png</code>. This image has a cyan background and contains 30 soybean grains that touch with each other. Two segmentation strategies are used. The first one is by using is image segmentation based on color indexes.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">soy</span> <span class="op">&lt;-</span>        <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"soybean_touch.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="va">grain</span> <span class="op">&lt;-</span>      <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"soybean_grain.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="va">background</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"la_back.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/image_combine.html">image_combine</a></span><span class="op">(</span><span class="va">soy</span>, <span class="va">grain</span>, <span class="va">background</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
<p>The function <code><a href="../reference/count_objects.html">count_objects()</a></code> segment the image using as default the normalized blue index, as follows <span class="math inline">\(NB = (B/(R+G+B))\)</span>, where <span class="math inline">\(R\)</span>, <span class="math inline">\(G\)</span>, and <span class="math inline">\(B\)</span> are the red, green, and blue bands. Objects are count and the segmented objects are colored with random permutations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
                index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics       area   perimeter
#&gt;         min  1366.0000  117.000000
#&gt;        mean  2057.3667  146.600000
#&gt;         max  2445.0000  158.000000
#&gt;          sd   230.5574    8.406073
#&gt;         sum 61721.0000 4398.000000</code></pre>
<p>Users can remove the random coloration and identify the objects (in this example the grains) by using the arguments <code>marker = "text"</code> and <code>show_segmentation = FALSE</code>. The color of the background can also be changed with <code>col_background</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
                marker <span class="op">=</span> <span class="st">"text"</span>,
                show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
                col_background <span class="op">=</span> <span class="st">"white"</span>,
                index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-12-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics       area   perimeter
#&gt;         min  1366.0000  117.000000
#&gt;        mean  2057.3667  146.600000
#&gt;         max  2445.0000  158.000000
#&gt;          sd   230.5574    8.406073
#&gt;         sum 61721.0000 4398.000000</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the object measures</span>
<span class="op">(</span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    id       x       y area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1   1 245.833 509.841 2286       158      26.543     22.763     28.941</span>
<span class="co">#&gt; 2   2 538.056 401.896 2299       153      26.607     24.957     28.400</span>
<span class="co">#&gt; 3   3 237.592 339.825 2312       152      26.699     23.965     29.044</span>
<span class="co">#&gt; 4   4 345.357 105.783 2445       158      27.513     24.682     30.471</span>
<span class="co">#&gt; 5   5 406.931  77.549 2302       153      26.649     23.965     29.636</span>
<span class="co">#&gt; 6   6 277.445 260.559 2163       149      25.766     24.291     27.887</span>
<span class="co">#&gt; 7   7 301.206 370.092 2217       154      26.113     23.591     28.687</span>
<span class="co">#&gt; 8   8 192.828 379.645 2207       149      26.105     23.715     28.858</span>
<span class="co">#&gt; 9   9 434.710 553.707 2174       148      25.890     23.750     28.506</span>
<span class="co">#&gt; 10 10 594.744  47.311 2219       153      26.160     23.352     29.659</span>
<span class="co">#&gt; 11 11 468.997  56.425 2315       155      26.765     23.031     30.780</span>
<span class="co">#&gt; 12 12 461.172 156.027 2175       148      25.933     23.071     29.512</span>
<span class="co">#&gt; 13 13 202.075 203.461 2188       153      26.008     22.487     29.808</span>
<span class="co">#&gt; 14 14 403.486 169.015 2035       143      25.019     22.398     27.010</span>
<span class="co">#&gt; 15 15 245.987 221.375 2117       148      25.528     21.950     29.113</span>
<span class="co">#&gt; 16 16 250.400 436.934 1964       142      24.552     22.971     26.258</span>
<span class="co">#&gt; 17 17  84.671 206.432 2183       151      25.923     22.825     28.743</span>
<span class="co">#&gt; 18 18 448.412 296.209 2068       145      25.196     23.357     27.032</span>
<span class="co">#&gt; 19 19 296.178 186.505 2056       144      25.132     22.639     27.213</span>
<span class="co">#&gt; 20 20 321.973 321.691 1978       151      24.635     21.223     27.370</span>
<span class="co">#&gt; 21 21 550.202 200.506 1939       141      24.400     22.578     26.353</span>
<span class="co">#&gt; 22 22 106.294 432.089 1922       140      24.304     22.838     26.264</span>
<span class="co">#&gt; 23 23 242.940 388.543 1926       146      24.391     22.412     27.420</span>
<span class="co">#&gt; 24 24 492.988 344.441 1891       139      24.076     21.894     25.988</span>
<span class="co">#&gt; 25 25 721.705 586.342 1915       140      24.250     21.886     26.818</span>
<span class="co">#&gt; 26 26 510.468 158.372 1787       137      23.466     21.173     26.180</span>
<span class="co">#&gt; 27 27  92.838 569.395 1743       134      23.124     21.249     25.332</span>
<span class="co">#&gt; 28 28 281.037 474.071 1819       154      23.484     17.887     27.203</span>
<span class="co">#&gt; 29 29 273.273 547.459 1710       143      22.780     17.617     25.910</span>
<span class="co">#&gt; 30 30 265.292 143.411 1366       117      20.405     18.590     22.030</span>
<span class="co">#&gt;    radius_sd radius_ratio</span>
<span class="co">#&gt; 1      1.425        1.271</span>
<span class="co">#&gt; 2      0.935        1.138</span>
<span class="co">#&gt; 3      1.233        1.212</span>
<span class="co">#&gt; 4      1.730        1.235</span>
<span class="co">#&gt; 5      1.640        1.237</span>
<span class="co">#&gt; 6      0.765        1.148</span>
<span class="co">#&gt; 7      1.358        1.216</span>
<span class="co">#&gt; 8      1.488        1.217</span>
<span class="co">#&gt; 9      1.437        1.200</span>
<span class="co">#&gt; 10     1.856        1.270</span>
<span class="co">#&gt; 11     2.349        1.336</span>
<span class="co">#&gt; 12     1.656        1.279</span>
<span class="co">#&gt; 13     1.987        1.326</span>
<span class="co">#&gt; 14     1.168        1.206</span>
<span class="co">#&gt; 15     1.793        1.326</span>
<span class="co">#&gt; 16     0.798        1.143</span>
<span class="co">#&gt; 17     1.708        1.259</span>
<span class="co">#&gt; 18     0.993        1.157</span>
<span class="co">#&gt; 19     1.211        1.202</span>
<span class="co">#&gt; 20     1.595        1.290</span>
<span class="co">#&gt; 21     0.849        1.167</span>
<span class="co">#&gt; 22     0.891        1.150</span>
<span class="co">#&gt; 23     0.958        1.223</span>
<span class="co">#&gt; 24     1.180        1.187</span>
<span class="co">#&gt; 25     1.350        1.225</span>
<span class="co">#&gt; 26     1.009        1.236</span>
<span class="co">#&gt; 27     1.044        1.192</span>
<span class="co">#&gt; 28     2.497        1.521</span>
<span class="co">#&gt; 29     1.792        1.471</span>
<span class="co">#&gt; 30     0.772        1.185</span></code></pre></div>
<p>In the following example, we will select objects with an area above the average of all objects by using <code>lower_size = 2057.36</code>. Additionally, we will use the argument <code>show_original = FALSE</code> to show the results as colors (non-original image).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
              marker <span class="op">=</span> <span class="st">"text"</span>,
              show_original <span class="op">=</span> <span class="cn">FALSE</span>,
              show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
              lower_size <span class="op">=</span> <span class="fl">2057.36</span>,
              index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 16 
#&gt; --------------------------------------------
#&gt;  statistics        area  perimeter
#&gt;         min  2068.00000  145.00000
#&gt;        mean  2229.37500  151.68750
#&gt;         max  2445.00000  158.00000
#&gt;          sd    92.26908    3.68273
#&gt;         sum 35670.00000 2427.00000</code></pre>
<p>Users can also select the top <code>n</code> objects based on either smaller or largest areas. Letâ€™s see how to point out the 5 grains with the smallest area, showing the original grains in a blue background. We will also use the argument <code>my_index</code> to choose a personalized index to segment the image. Just for comparison, we will set up explicitly the normalized blue index by calling <code>my_index = "B/(R+G+B)"</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
              marker <span class="op">=</span> <span class="st">"point"</span>,
              show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
              topn_lower <span class="op">=</span> <span class="fl">5</span>,
              col_background <span class="op">=</span> <span class="st">"blue"</span>,
              my_index <span class="op">=</span> <span class="st">"B/(R+G+B)"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-15-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 5 
#&gt; --------------------------------------------
#&gt;  statistics      area perimeter
#&gt;         min 1366.0000 117.00000
#&gt;        mean 1685.0000 137.00000
#&gt;         max 1819.0000 154.00000
#&gt;          sd  183.1052  13.54622
#&gt;         sum 8425.0000 685.00000</code></pre>
<div id="using-sample-palettes" class="section level3">
<h3 class="hasAnchor">
<a href="#using-sample-palettes" class="anchor"></a>Using sample palettes</h3>
<p>Sometimes it is difficult to choose an image index that segments the image efficiently (even using <code>my_index</code> ). In <code>pliman</code> users have an alternative image segmentation strategy that is using sample color palettes. In this case, users can say to <code>count_objects</code> which color palettes are to be used for background and foreground. A generalized linear model (binomial family) is then used to predict the value of each pixel (background or foreground). Letâ€™s see how the grains of the above image can be counted with this strategy.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">soy</span>,
              background <span class="op">=</span> <span class="va">background</span>,
              foreground <span class="op">=</span> <span class="va">grain</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-16-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics      area   perimeter
#&gt;         min  1596.000  128.000000
#&gt;        mean  2409.667  160.900000
#&gt;         max  2797.000  171.000000
#&gt;          sd   263.389    9.117433
#&gt;         sum 72290.000 4827.000000</code></pre>
<p>Provided that the images are stored in the current working directory (or subdirectory), users can count the objects with no need to first import the image into the R environment. In this case, image names need to be declared as characters. Assuming that soy, background, and grain are the images saved into the current working directory, the same result as above is obtained with</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img <span class="op">=</span> <span class="st">"soy"</span>,
              background <span class="op">=</span> <span class="st">"background"</span>,
              foreground <span class="op">=</span> <span class="st">"grain"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="batch-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#batch-processing" class="anchor"></a>Batch processing</h1>
<p>In plant image analysis, frequently it is necessary to process more than one image. For example, in plant breeding, the number of grains per plant (e.g., wheat) is frequently used in the indirect selection of high-yielding plants. In <code>pliman</code>, batch processing can be done when the user declares the argument <code>img_pattern</code>.</p>
<p>The following example would be used to count the objects in the images with a pattern name <code>"trat"</code> (e.g., <code>"trat1"</code>, <code>"trat2"</code>, <code>"tratn"</code>) saved into the subfolder "<code>originals"</code> in the current working directory. The processed images will be saved into the subfolder <code>"processed"</code>. The object <code>list_res</code> will be a list with two objects (<code>results</code> and <code>statistics</code>) for each image.</p>
<p>To speed up the processing time, especially for a large number of images, the argument <code>parallel = TRUE</code> can be used. In this case, the images are processed asynchronously (in parallel) in separate <code>R</code> sessions running in the background on the same machine. The number of sections is set up to 90% of available cores. This number can be controlled explicitly with the argument <code>workers</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_res</span> <span class="op">&lt;-</span> 
<span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img_pattern <span class="op">=</span> <span class="st">"trat"</span>, <span class="co"># matches the name pattern in 'originals' subfolder</span>
              dir_original <span class="op">=</span> <span class="st">"originals"</span>,
              dir_processed <span class="op">=</span> <span class="st">"processed"</span>,
              parallel <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># parallel processing</span>
              workers <span class="op">=</span> <span class="fl">8</span>, <span class="co"># 8 multiple sections</span>
              save_image <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://olivoto.netlify.app/">Tiago Olivoto</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
