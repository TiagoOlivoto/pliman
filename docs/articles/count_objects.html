<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Count objects in an image â€¢ pliman</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Count objects in an image">
<meta property="og:description" content="pliman">
<meta property="og:image" content="https://tiagoolivoto.github.io/pliman/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-VWN5YL53DP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VWN5YL53DP');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pliman</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/operations.html">Image Operations</a>
    </li>
    <li>
      <a href="../articles/manipulation.html">Image manipulation</a>
    </li>
    <li>
      <a href="../articles/segmentation.html">Image segmentation</a>
    </li>
    <li>
      <a href="../articles/count_objects.html">Count objects in an image</a>
    </li>
    <li>
      <a href="../articles/leaf_area.html">Measure leaf area</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../CODE_OF_CONDUCT.html">Code of Conduct</a>
    </li>
    <li>
      <a href="../CONTRIBUTING.html">Contributing</a>
    </li>
    <li>
      <a href="../ISSUE_TEMPLATE.html">Issues</a>
    </li>
    <li>
      <a href="../SUPPORT.html">Support</a>
    </li>
    <li>
      <a href="../LICENSE.html">Licence</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.researchgate.net/profile/Tiago_Olivoto2">RG</a>
</li>
<li>
  <a href="https://github.com/TiagoOlivoto">
    <span class="fab fab-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/tolivoto">
    <span class="fab fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://www.mendeley.com/profiles/tiago-olivoto/">
    <span class="fab fa-mendeley"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="count_objects_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Count objects in an image</h1>
                        <h4 class="author">Tiago Olivoto</h4>
            
            <h4 class="date">2021-05-13</h4>
      
      
      <div class="hidden name"><code>count_objects.Rmd</code></div>

    </div>

    
    
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<p>The function <code><a href="../reference/count_objects.html">count_objects()</a></code> can be used to count objects in an image. Let us start with a simple example with the image <code>object_300dpi.png</code> available in the <a href="https://github.com/TiagoOlivoto/pliman/tree/master/image_examples">GitHub page</a>. To facilitate the image importation from this folder, a helper function <code><a href="../reference/utils_image.html">image_pliman()</a></code> is used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pliman</span><span class="op">)</span>
<span class="co">#&gt; |========================================================|</span>
<span class="co">#&gt; | Tools for Plant Image Analysis (pliman) v0.1.0         |</span>
<span class="co">#&gt; | Author: Tiago Olivoto                                  |</span>
<span class="co">#&gt; | Type 'vignette('pliman_start')' for a short tutorial   |</span>
<span class="co">#&gt; | Visit 'https://bit.ly/2RP2kyE' for a complete tutorial |</span>
<span class="co">#&gt; |========================================================|</span>
<span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"objects_300dpi.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/utils_image.html">image_show</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-2-1.png" width="960"></p>
<p>The above image was produced with Microsoft PowerPoint. It has a known resolution of 300 dpi (dots per inch) and shows four objects</p>
<ul>
<li>Larger square: 10 x 10 cm (100 cm<sup>2</sup>)</li>
<li>Smaller square: 5 x 5 cm (25 cm<sup>2</sup>)</li>
<li>Rectangle: 4 x 2 cm (8 cm<sup>2</sup>)</li>
<li>Circle: 3 cm in diameter (~7.08 cm<sup>2</sup>)</li>
</ul>
<p>To count the objects in the image we use <code><a href="../reference/count_objects.html">count_objects()</a></code> and inform the image object (the only mandatory argument). First, we use <code><a href="../reference/image_binary.html">image_binary()</a></code> to see the most suitable index to segment the objects from the background. By default, the R, G, B (first row) and their normalized values (second row) are used.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/image_binary.html">image_binary</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img_res</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">img</span>,
                index <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="co"># use blue index to segment</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 4 
#&gt; --------------------------------------------
#&gt;  statistics      area perimeter
#&gt;         min   98363.0  1030.000
#&gt;        mean  488297.5  2378.000
#&gt;         max 1394754.0  4715.000
#&gt;          sd  615160.4  1655.097
#&gt;         sum 1953190.0  9512.000</code></pre>
</div>
<div id="getting-the-object-measures" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-the-object-measures" class="anchor"></a>Getting the object measures</h1>
<p>The results were stored in <code>img_res</code> and a summary print in the console. The minimum, mean, maximum, standard deviation and sum of pixels are given for both area and perimeter. The values for each object can be obtained with <code><a href="../reference/utils_measures.html">get_measures()</a></code>. Since there is no scale declared in the above example, we have no idea about the actual area of the objects in cm<sup>2</sup>, only in pixels.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   id         x         y    area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  668.9996  797.9996 1394754      4715    677.0314   589.8749   833.6795</span>
<span class="co">#&gt; 2  2 1737.5000  453.0000  348690      2358    338.3123   294.5000   416.8396</span>
<span class="co">#&gt; 3  3 1737.5482 1296.3454   98363      1030    176.4897   174.8776   177.8908</span>
<span class="co">#&gt; 4  4 1737.4979  939.4926  111383      1409    197.4469   117.4128   262.9966</span>
<span class="fu"><a href="../reference/utils_image.html">image_show</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span>
<span class="fu"><a href="../reference/utils_measures.html">plot_measures</a></span><span class="op">(</span><span class="va">measures</span><span class="op">)</span> <span class="co"># plot the object id</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
</div>
<div id="adjusting-object-measures" class="section level1">
<h1 class="hasAnchor">
<a href="#adjusting-object-measures" class="anchor"></a>Adjusting object measures</h1>
<p>There are two main ways of adjusting the object measures (from pixels to cm, for example). The first one is to declare the known area, perimeter, or radius of a given object. The measure for the other objects will be then computed by a simple rule of three. The second one is by declaring a known image resolution in dpi (dots per inch). In this case, the perimeter, area, and radius will be adjusted by the informed dpi.</p>
<div id="declaring-a-known-value" class="section level2">
<h2 class="hasAnchor">
<a href="#declaring-a-known-value" class="anchor"></a>Declaring a known value</h2>
<p>Since we have known the area of the larger square (object 1), let us adjust the area of the other objects in the image using that.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>,
             id <span class="op">=</span> <span class="fl">1</span>,
             <span class="va">area</span> <span class="op">~</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; measures corrected with:</span>
<span class="co">#&gt; object id: 1</span>
<span class="co">#&gt; area: 100</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt;   id         x         y       area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  668.9996  797.9996 100.000000 39.923894    5.732711  4.9947194   7.059116</span>
<span class="co">#&gt; 2  2 1737.5000  453.0000  25.000108 19.966181    2.864633  2.4936557   3.529557</span>
<span class="co">#&gt; 3  3 1737.5482 1296.3454   7.052355  8.721444    1.494413  1.4807620   1.506276</span>
<span class="co">#&gt; 4  4 1737.4979  939.4926   7.985853 11.930597    1.671866  0.9941839   2.226903</span></code></pre></div>
<p>The same can be used to adjust the measures based on the perimeter or radius. Let us adjust the perimeter of objects by the perimeter of object 2 (20 cm).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>,
             id <span class="op">=</span> <span class="fl">2</span>,
             <span class="va">perimeter</span> <span class="op">~</span> <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt; measures corrected with:</span>
<span class="co">#&gt; object id: 2</span>
<span class="co">#&gt; perimeter: 20</span>
<span class="co">#&gt; -----------------------------------------</span>
<span class="co">#&gt;   id         x         y       area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  668.9996  797.9996 100.339055 39.991518    5.742421  5.0031796   7.071073</span>
<span class="co">#&gt; 2  2 1737.5000  453.0000  25.084872 20.000000    2.869485  2.4978796   3.535535</span>
<span class="co">#&gt; 3  3 1737.5482 1296.3454   7.076266  8.736217    1.496944  1.4832701   1.508828</span>
<span class="co">#&gt; 4  4 1737.4979  939.4926   8.012929 11.950806    1.674698  0.9958679   2.230675</span></code></pre></div>
</div>
<div id="declaring-the-image-resolution" class="section level2">
<h2 class="hasAnchor">
<a href="#declaring-the-image-resolution" class="anchor"></a>Declaring the image resolution</h2>
<p>If the image resolution is known, all the measures will be adjusted according to this resolution. Let us to see a numerical example with <code><a href="../reference/utils_dpi.html">pixels_to_cm()</a></code>. This function converts the number of pixels (<span class="math inline">\(px\)</span>) to cm, considering the image resolution in <span class="math inline">\(dpi\)</span>, as follows: <span class="math inline">\(cm = px \times (2.54/dpi)\)</span>. We have known that the larger square has a perimeter of 4720 pixels. So, using the function we have</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_dpi.html">pixels_to_cm</a></span><span class="op">(</span>px <span class="op">=</span> <span class="fl">4720</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#&gt; [1] 39.96267</span></code></pre></div>
<p>The perimeter of object 1 adjusted by the image resolution is very close to the true (40 cm). Bellow, the values of all measures are adjusted by declaring the <code>dpi</code> argument in <code><a href="../reference/utils_measures.html">get_measures()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">img_res</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#&gt;   id         x         y      area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1  1  668.9996  797.9996 99.982166 39.920333    5.732200  4.9942740   7.058487</span>
<span class="co">#&gt; 2  2 1737.5000  453.0000 24.995649 19.964400    2.864377  2.4934333   3.529242</span>
<span class="co">#&gt; 3  3 1737.5482 1296.3454  7.051097  8.720667    1.494279  1.4806299   1.506142</span>
<span class="co">#&gt; 4  4 1737.4979  939.4926  7.984428 11.929533    1.671717  0.9940952   2.226705</span></code></pre></div>
</div>
</div>
<div id="counting-crop-grains" class="section level1">
<h1 class="hasAnchor">
<a href="#counting-crop-grains" class="anchor"></a>Counting crop grains</h1>
<p>Here, we will count the grains in the image <code>soybean_touch.png</code>. This image has a cyan background and contains 50 soybean grains that donâ€™t touch with each other. Two segmentation strategies are used. The first one is by using is image segmentation based on color indexes.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">soy</span> <span class="op">&lt;-</span>        <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"soybean_touch.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="va">grain</span> <span class="op">&lt;-</span>      <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"soybean_grain.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="va">background</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_image.html">image_import</a></span><span class="op">(</span><span class="fu"><a href="../reference/utils_image.html">image_pliman</a></span><span class="op">(</span><span class="st">"background.jpg"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/image_combine.html">image_combine</a></span><span class="op">(</span><span class="va">soy</span>, <span class="va">grain</span>, <span class="va">background</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
<p>The function <code><a href="../reference/count_objects.html">count_objects()</a></code> segment the image using as default the normalized blue index, as follows <span class="math inline">\(NB = (B/(R+G+B))\)</span>, where <span class="math inline">\(R\)</span>, <span class="math inline">\(G\)</span>, and <span class="math inline">\(B\)</span> are the red, green, and blue bands. Objects are count and the segmented objects are colored with random permutations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
                index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics       area   perimeter
#&gt;         min  1366.0000  117.000000
#&gt;        mean  2057.3667  146.600000
#&gt;         max  2445.0000  158.000000
#&gt;          sd   230.5574    8.406073
#&gt;         sum 61721.0000 4398.000000</code></pre>
<p>Users can remove the random coloration and identify the objects (in this example the grains) by using the arguments <code>marker = "text"</code> and <code>show_segmentation = FALSE</code>. The color of the background can also be changed with <code>col_background</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
                marker <span class="op">=</span> <span class="st">"text"</span>,
                show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
                col_background <span class="op">=</span> <span class="st">"white"</span>,
                index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-12-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics       area   perimeter
#&gt;         min  1366.0000  117.000000
#&gt;        mean  2057.3667  146.600000
#&gt;         max  2445.0000  158.000000
#&gt;          sd   230.5574    8.406073
#&gt;         sum 61721.0000 4398.000000</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the object measures</span>
<span class="op">(</span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/utils_measures.html">get_measures</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    id         x         y area perimeter radius_mean radius_min radius_max</span>
<span class="co">#&gt; 1   1 245.83333 509.84077 2286       158    26.54285   22.76306   28.94132</span>
<span class="co">#&gt; 2   2 538.05611 401.89604 2299       153    26.60716   24.95688   28.40020</span>
<span class="co">#&gt; 3   3 237.59170 339.82483 2312       152    26.69878   23.96521   29.04402</span>
<span class="co">#&gt; 4   4 345.35665 105.78323 2445       158    27.51343   24.68250   30.47116</span>
<span class="co">#&gt; 5   5 406.93136  77.54909 2302       153    26.64891   23.96546   29.63586</span>
<span class="co">#&gt; 6   6 277.44521 260.55941 2163       149    25.76600   24.29055   27.88707</span>
<span class="co">#&gt; 7   7 301.20568 370.09157 2217       154    26.11345   23.59087   28.68747</span>
<span class="co">#&gt; 8   8 192.82827 379.64522 2207       149    26.10523   23.71544   28.85848</span>
<span class="co">#&gt; 9   9 434.71021 553.70653 2174       148    25.89026   23.74971   28.50595</span>
<span class="co">#&gt; 10 10 594.74403  47.31095 2219       153    26.16024   23.35200   29.65932</span>
<span class="co">#&gt; 11 11 468.99698  56.42549 2315       155    26.76542   23.03064   30.78003</span>
<span class="co">#&gt; 12 12 461.17241 156.02713 2175       148    25.93324   23.07091   29.51196</span>
<span class="co">#&gt; 13 13 202.07541 203.46115 2188       153    26.00756   22.48701   29.80797</span>
<span class="co">#&gt; 14 14 403.48649 169.01474 2035       143    25.01919   22.39798   27.00994</span>
<span class="co">#&gt; 15 15 245.98677 221.37506 2117       148    25.52815   21.95011   29.11295</span>
<span class="co">#&gt; 16 16 250.40020 436.93432 1964       142    24.55216   22.97147   26.25762</span>
<span class="co">#&gt; 17 17  84.67109 206.43152 2183       151    25.92309   22.82494   28.74282</span>
<span class="co">#&gt; 18 18 448.41151 296.20890 2068       145    25.19611   23.35700   27.03161</span>
<span class="co">#&gt; 19 19 296.17753 186.50535 2056       144    25.13231   22.63931   27.21284</span>
<span class="co">#&gt; 20 20 321.97321 321.69110 1978       151    24.63527   21.22252   27.36964</span>
<span class="co">#&gt; 21 21 550.20165 200.50645 1939       141    24.39962   22.57787   26.35292</span>
<span class="co">#&gt; 22 22 106.29396 432.08949 1922       140    24.30404   22.83775   26.26388</span>
<span class="co">#&gt; 23 23 242.94029 388.54309 1926       146    24.39053   22.41236   27.41985</span>
<span class="co">#&gt; 24 24 492.98784 344.44104 1891       139    24.07625   21.89427   25.98781</span>
<span class="co">#&gt; 25 25 721.70496 586.34204 1915       140    24.24984   21.88597   26.81782</span>
<span class="co">#&gt; 26 26 510.46838 158.37213 1787       137    23.46584   21.17273   26.18003</span>
<span class="co">#&gt; 27 27  92.83821 569.39472 1743       134    23.12420   21.24944   25.33156</span>
<span class="co">#&gt; 28 28 281.03738 474.07147 1819       154    23.48401   17.88658   27.20260</span>
<span class="co">#&gt; 29 29 273.27251 547.45906 1710       143    22.78041   17.61722   25.90980</span>
<span class="co">#&gt; 30 30 265.29209 143.41142 1366       117    20.40475   18.59025   22.03007</span></code></pre></div>
<p>In the following example, we will select objects with an area above the average of all objects by using <code>lower_size = 2057.36</code>. Additionally, we will use the argument <code>show_original = FALSE</code> to show the results as colors (non-original image).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
              marker <span class="op">=</span> <span class="st">"text"</span>,
              show_original <span class="op">=</span> <span class="cn">FALSE</span>,
              show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
              lower_size <span class="op">=</span> <span class="fl">2057.36</span>,
              index <span class="op">=</span> <span class="st">"NB"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 16 
#&gt; --------------------------------------------
#&gt;  statistics        area  perimeter
#&gt;         min  2068.00000  145.00000
#&gt;        mean  2229.37500  151.68750
#&gt;         max  2445.00000  158.00000
#&gt;          sd    92.26908    3.68273
#&gt;         sum 35670.00000 2427.00000</code></pre>
<p>Users can also select the top <code>n</code> objects based on either smaller or largest areas. Letâ€™s see how to point out the 5 grains with the smallest area, showing the original grains in a blue background. We will also use the argument <code>my_index</code> to choose a personalized index to segment the image. Just for comparison, we will set up explicitly the normalized blue index by calling <code>my_index = "B/(R+G+B)"</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span><span class="va">soy</span>,
              marker <span class="op">=</span> <span class="st">"point"</span>,
              show_segmentation <span class="op">=</span> <span class="cn">FALSE</span>,
              topn_lower <span class="op">=</span> <span class="fl">5</span>,
              col_background <span class="op">=</span> <span class="st">"blue"</span>,
              my_index <span class="op">=</span> <span class="st">"B/(R+G+B)"</span><span class="op">)</span> <span class="co"># default</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-15-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 5 
#&gt; --------------------------------------------
#&gt;  statistics      area perimeter
#&gt;         min 1366.0000 117.00000
#&gt;        mean 1685.0000 137.00000
#&gt;         max 1819.0000 154.00000
#&gt;          sd  183.1052  13.54622
#&gt;         sum 8425.0000 685.00000</code></pre>
<div id="using-sample-palettes" class="section level3">
<h3 class="hasAnchor">
<a href="#using-sample-palettes" class="anchor"></a>Using sample palettes</h3>
<p>Sometimes it is difficult to choose an image index that segments the image efficiently (even using <code>my_index</code> ). In <code>pliman</code> users have an alternative image segmentation strategy that is using sample color palettes. In this case, users can say to <code>count_objects</code> which color palettes are to be used for background and foreground. A generalized linear model (binomial family) is then used to predict the value of each pixel (background or foreground). Letâ€™s see how the grains of the above image can be counted with this strategy.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">soy</span>,
              background <span class="op">=</span> <span class="va">background</span>,
              foreground <span class="op">=</span> <span class="va">grain</span><span class="op">)</span></code></pre></div>
<p><img src="count_objects_files/figure-html/unnamed-chunk-16-1.png" width="960"></p>
<pre><code>#&gt; 
#&gt; --------------------------------------------
#&gt; Number of objects: 30 
#&gt; --------------------------------------------
#&gt;  statistics       area   perimeter
#&gt;         min  1570.0000  128.000000
#&gt;        mean  2386.7667  159.266667
#&gt;         max  2785.0000  171.000000
#&gt;          sd   260.0185    8.815869
#&gt;         sum 71603.0000 4778.000000</code></pre>
<p>Provided that the images are stored in the current working directory (or subdirectory), users can count the objects with no need to first import the image into the R environment. In this case, image names need to be declared as characters. Assuming that soy, background, and grain are the images saved into the current working directory, the same result as above is obtained with</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img <span class="op">=</span> <span class="st">"soy"</span>,
              background <span class="op">=</span> <span class="st">"background"</span>,
              foreground <span class="op">=</span> <span class="st">"grain"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="batch-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#batch-processing" class="anchor"></a>Batch processing</h1>
<p>In plant image analysis, frequently it is necessary to process more than one image. For example, in plant breeding, the number of grains per plant (e.g., wheat) is frequently used in the indirect selection of high-yielding plants. In <code>pliman</code>, batch processing can be done when the user declares the argument <code>img_pattern</code>.</p>
<p>The following example would be used to count the objects in the images with a pattern name <code>"trat"</code> (e.g., <code>"trat1"</code>, <code>"trat2"</code>, <code>"tratn"</code>) saved into the subfolder "<code>originals"</code> in the current working directory. The processed images will be saved into the subfolder <code>"processed"</code>. The object <code>list_res</code> will be a list with two objects (<code>results</code> and <code>statistics</code>) for each image.</p>
<p>To speed up the processing time, especially for a large number of images, the argument <code>parallel = TRUE</code> can be used. In this case, the images are processed asynchronously (in parallel) in separate <code>R</code> sessions running in the background on the same machine. The number of sections is set up to 90% of available cores. This number can be controlled explicitly with the argument <code>workers</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_res</span> <span class="op">&lt;-</span> 
<span class="fu"><a href="../reference/count_objects.html">count_objects</a></span><span class="op">(</span>img_pattern <span class="op">=</span> <span class="st">"trat"</span>, <span class="co"># matches the name pattern in 'originals' subfolder</span>
              dir_original <span class="op">=</span> <span class="st">"originals"</span>,
              dir_processed <span class="op">=</span> <span class="st">"processed"</span>,
              parallel <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># parallel processing</span>
              workers <span class="op">=</span> <span class="fl">8</span>, <span class="co"># 8 multiple sections</span>
              save_image <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://olivoto.netlify.app/">Tiago Olivoto</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
